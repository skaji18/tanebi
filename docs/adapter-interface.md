# TANEBI ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ä»•æ§˜æ›¸

> æœ¬æ–‡æ›¸ã¯ [design.md](design.md) Section 3 ã®è©³ç´°ä»•æ§˜ã§ã‚ã‚‹ã€‚
> ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼å®Ÿè£…è€…ã¯ã“ã®ä»•æ§˜ã«æº–æ‹ ã™ã‚‹ã“ã¨ã€‚

---

## 1. ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼æ¦‚è¦

### ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã¨ã¯

ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã¯ **ãƒ¯ãƒ¼ã‚«ãƒ¼èµ·å‹•æ–¹å¼ã®æŠ½è±¡åŒ–ãƒ¬ã‚¤ãƒ¤ãƒ¼** ã§ã‚ã‚‹ã€‚
TANEBIãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®ã‚³ã‚¢ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆé€²åŒ–ã‚¨ãƒ³ã‚¸ãƒ³ãƒ»äººæ ¼ç®¡ç†ãƒ»ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚·ã‚¹ãƒ†ãƒ ï¼‰ã‚’
ç‰¹å®šã®å®Ÿè¡Œç’°å¢ƒã‹ã‚‰åˆ‡ã‚Šé›¢ã—ã€ã©ã®ç’°å¢ƒã§ã‚‚åŒã˜ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿç¾ã™ã‚‹ã€‚

### è¨­è¨ˆæ€æƒ³

```
TANEBI Coreï¼ˆç’°å¢ƒéä¾å­˜ï¼‰
    â†“ 5ã¤ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆIF-001ã€œIF-005ï¼‰
Adapterï¼ˆç’°å¢ƒå›ºæœ‰ã®å®Ÿè£…ï¼‰
    â†“
å®Ÿè¡Œç’°å¢ƒï¼ˆClaude Code / subprocess / HTTP / Docker ...ï¼‰
```

ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã¯ä»¥ä¸‹ã®åŸå‰‡ã«å¾“ã†:

- **å˜ä¸€è²¬å‹™**: å„ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¯1ã¤ã®æ“ä½œã«å¯¾å¿œã™ã‚‹
- **å…¥å‡ºåŠ›ã¯YAML**: ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿äº¤æ›ã¯YAMLå½¢å¼ã§è¡Œã†
- **ã‚¨ãƒ©ãƒ¼ã¯æ˜ç¤ºçš„**: å¤±æ•—æ™‚ã¯ exit code != 0 + stderr ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

### ç¾åœ¨ã®ã‚µãƒãƒ¼ãƒˆçŠ¶æ³

| ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ | çŠ¶æ…‹ | å‚™è€ƒ |
|-----------|------|------|
| **claude-native** | âœ… MVPå®Ÿè£…æ¸ˆã¿ | Claude Code ã® Task tool ãƒ™ãƒ¼ã‚¹ã€‚ã‚¼ãƒ­ã‚¤ãƒ³ãƒ•ãƒ© |
| subprocess | ğŸ“‹ å°†æ¥äºˆå®š | å¤–éƒ¨ãƒ—ãƒ­ã‚»ã‚¹ã¨ã—ã¦ãƒ¯ãƒ¼ã‚«ãƒ¼ã‚’èµ·å‹• |
| http | ğŸ“‹ å°†æ¥äºˆå®š | HTTP API çµŒç”±ã§ãƒªãƒ¢ãƒ¼ãƒˆãƒ¯ãƒ¼ã‚«ãƒ¼ã‚’å‘¼ã³å‡ºã— |

---

## 2. å¿…é ˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆ5ã¤ï¼‰

ã™ã¹ã¦ã®ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã¯ä»¥ä¸‹ã®5ã¤ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®Ÿè£…ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€‚

### IF-001: decompose(task_yaml) â†’ subtasks[]

ã‚¿ã‚¹ã‚¯YAMLã‚’å—ã‘å–ã‚Šã€ã‚µãƒ–ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆã«åˆ†è§£ã™ã‚‹ã€‚

#### å…¥åŠ›

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | èª¬æ˜ |
|-----------|-----|------|
| `task_yaml` | string | ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¿ã‚¹ã‚¯ä¾é ¼å†…å®¹ï¼ˆ`work/cmd_NNN/request.md`ï¼‰ |
| `persona_list` | string[] | åˆ©ç”¨å¯èƒ½ãªPersonaãƒ•ã‚¡ã‚¤ãƒ«åä¸€è¦§ï¼ˆ`personas/active/*.yaml`ï¼‰ |
| `plan_path` | string | å‡ºåŠ›å…ˆãƒ‘ã‚¹ï¼ˆ`work/cmd_NNN/plan.md`ï¼‰ |
| `cmd_id` | string | ã‚³ãƒãƒ³ãƒ‰IDï¼ˆä¾‹: `cmd_001`ï¼‰ |

#### å‡ºåŠ›

`plan.md` ãƒ•ã‚¡ã‚¤ãƒ«ã€‚ä»¥ä¸‹ã®YAMLæ§‹é€ ã‚’å«ã‚€:

```yaml
plan:
  cmd: cmd_001
  created_at: "2026-03-01T12:00:00"
  total_subtasks: 3
  waves: 2

  subtasks:
    - id: subtask_001
      description: "ã‚¿ã‚¹ã‚¯å†…å®¹"
      persona: generalist_v1
      output_path: "work/cmd_001/results/subtask_001.md"
      depends_on: []
      wave: 1
    - id: subtask_002
      description: "ä¾å­˜ã‚¿ã‚¹ã‚¯"
      persona: backend_specialist_v1
      output_path: "work/cmd_001/results/subtask_002.md"
      depends_on: [subtask_001]
      wave: 2
```

#### è²¬å‹™

- ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¾é ¼ã‚’ã‚µãƒ–ã‚¿ã‚¹ã‚¯ã«åˆ†å‰²
- å„ã‚µãƒ–ã‚¿ã‚¹ã‚¯ã«æœ€é©ãªPersonaã‚’å‰²ã‚Šå½“ã¦ï¼ˆ`evolution.fitness_score` å„ªå…ˆï¼‰
- ä¾å­˜é–¢ä¿‚ã‚’waveç•ªå·ã§è¡¨ç¾ï¼ˆåŒä¸€wave = ä¸¦åˆ—å®Ÿè¡Œå¯èƒ½ï¼‰
- é©åˆPersonaãŒãªã„å ´åˆã¯ `generalist_v1` ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯

#### claude-native å®Ÿè£…

`templates/decomposer.md` ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§Task toolã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’èµ·å‹•ã€‚
ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ `{REQUEST_PATH}`, `{PERSONA_LIST}`, `{PLAN_PATH}`, `{CMD_ID}`, `{TIMESTAMP}` ã‚’å±•é–‹ã—ã¦æ¸¡ã™ã€‚

---

### IF-002: execute(subtask_yaml, persona_yaml) â†’ result_yaml

ã‚µãƒ–ã‚¿ã‚¹ã‚¯ã¨Personaã‚’å—ã‘å–ã‚Šã€ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã—ã¦çµæœYAMLã‚’è¿”ã™ã€‚

#### å…¥åŠ›

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | èª¬æ˜ |
|-----------|-----|------|
| `subtask_yaml` | object | `plan.md` å†…ã®ã‚µãƒ–ã‚¿ã‚¹ã‚¯å®šç¾© |
| `persona_yaml` | string | Persona YAMLãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ï¼ˆ`personas/active/{id}.yaml`ï¼‰ |
| `few_shot_paths` | string[] | é–¢é€£Few-Shotäº‹ä¾‹ã®ãƒ‘ã‚¹ä¸€è¦§ |
| `output_path` | string | çµæœã®å‡ºåŠ›å…ˆï¼ˆ`work/cmd_NNN/results/{subtask_id}.md`ï¼‰ |

#### å‡ºåŠ›

YAML frontmatterä»˜ãMarkdownãƒ•ã‚¡ã‚¤ãƒ«:

```yaml
---
subtask_id: subtask_001
persona: generalist_v1
status: success        # success | failure
quality: GREEN         # GREEN | YELLOW | RED
domain: backend        # ã‚¿ã‚¹ã‚¯ã®ãƒ‰ãƒ¡ã‚¤ãƒ³åˆ†é¡
duration_estimate: short  # short(<5min) | medium(5-15min) | long(>15min)
---

# å®Ÿè¡Œçµæœ: subtask_001

## æˆæœç‰©
[ã‚¿ã‚¹ã‚¯ã®ä¸»è¦ãªæˆæœç‰©]

## ã‚µãƒãƒªãƒ¼
[1-3è¡Œã§ã®è¦ç´„]

## å®Ÿè¡Œãƒãƒ¼ãƒˆ
[åˆ¤æ–­éç¨‹ãƒ»æ³¨æ„ç‚¹ãƒ»èª²é¡Œ]
```

#### è²¬å‹™

- Persona YAMLã®äººæ ¼ï¼ˆå£èª¿ãƒ»è¡Œå‹•ç‰¹æ€§ï¼‰ã‚’ä½“ç¾ã—ã¦ã‚¿ã‚¹ã‚¯å®Ÿè¡Œ
- Few-Shotäº‹ä¾‹ãŒå­˜åœ¨ã™ã‚Œã°å‚ç…§ã—ã¦å“è³ªå‘ä¸Š
- `status` ã¨ `quality` ã‚’æ­£ç›´ã«è‡ªå·±è©•ä¾¡
- çµæœã‚’frontmatterä»˜ãMarkdownã§å‡ºåŠ›

#### claude-native å®Ÿè£…

`templates/worker_base.md` ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§Task toolã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’èµ·å‹•ã€‚
åŒä¸€waveå†…ã®ã‚µãƒ–ã‚¿ã‚¹ã‚¯ã¯ **åŒä¸€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§è¤‡æ•°Task toolå‘¼ã³å‡ºã—** ã«ã‚ˆã‚Šä¸¦åˆ—å®Ÿè¡Œã€‚
ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ `{PERSONA_PATH}`, `{PERSONA_NAME}`, `{SUBTASK_ID}`, `{TASK_DESCRIPTION}`, `{OUTPUT_PATH}` ç­‰ã‚’å±•é–‹ã—ã¦æ¸¡ã™ã€‚

---

### IF-003: aggregate(results[]) â†’ final_report

ã‚µãƒ–ã‚¿ã‚¹ã‚¯çµæœã‚’é›†ç´„ã—ã¦æœ€çµ‚å ±å‘Šæ›¸ã‚’ç”Ÿæˆã™ã‚‹ã€‚

#### å…¥åŠ›

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | èª¬æ˜ |
|-----------|-----|------|
| `results_dir` | string | çµæœãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆ`work/cmd_NNN/results/`ï¼‰ |
| `report_path` | string | ãƒ¬ãƒãƒ¼ãƒˆå‡ºåŠ›å…ˆï¼ˆ`work/cmd_NNN/report.md`ï¼‰ |
| `cmd_id` | string | ã‚³ãƒãƒ³ãƒ‰ID |

#### å‡ºåŠ›

YAML frontmatterä»˜ãçµ±åˆãƒ¬ãƒãƒ¼ãƒˆ:

```yaml
---
cmd: cmd_001
created_at: "2026-03-01T12:30:00"
total_subtasks: 3
succeeded: 3
failed: 0
quality_summary:
  GREEN: 2
  YELLOW: 1
  RED: 0
---

# ã‚¿ã‚¹ã‚¯å®Ÿè¡Œãƒ¬ãƒãƒ¼ãƒˆ: cmd_001

## ã‚µãƒãƒªãƒ¼
[å…¨ä½“ã®çµæœè¦ç´„]

## å„ã‚µãƒ–ã‚¿ã‚¹ã‚¯ã®çµæœ
| ã‚µãƒ–ã‚¿ã‚¹ã‚¯ | Persona | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | å“è³ª | ãƒ‰ãƒ¡ã‚¤ãƒ³ |
|-----------|---------|----------|------|--------|
| subtask_001 | generalist_v1 | âœ… success | ğŸŸ¢ GREEN | backend |

## æˆæœç‰©ä¸€è¦§
[å„ã‚µãƒ–ã‚¿ã‚¹ã‚¯ã®ä¸»è¦æˆæœç‰©]

## å“è³ªè©•ä¾¡
[æˆåŠŸç‡ãƒ»å“è³ªåˆ†å¸ƒ]
```

#### è²¬å‹™

- å…¨ã‚µãƒ–ã‚¿ã‚¹ã‚¯çµæœã®frontmatterã‚’åé›†ãƒ»é›†è¨ˆ
- å“è³ªã‚µãƒãƒªãƒ¼ï¼ˆGREEN/YELLOW/REDä»¶æ•°ï¼‰ã‚’æ­£ç¢ºã«ç®—å‡º
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¨ä½“åƒã‚’æŠŠæ¡ã§ãã‚‹çµ±åˆãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆ

#### claude-native å®Ÿè£…

`templates/aggregator.md` ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§Task toolã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’èµ·å‹•ã€‚
**ãƒ‘ã‚¹å—ã‘æ¸¡ã—ä¿‚åŸå‰‡**: ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ã¯ `results/` ã®ä¸­èº«ã‚’èª­ã¾ãšã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ‘ã‚¹ã®ã¿ã‚’Aggregatorã«æ¸¡ã™ã€‚

---

### IF-004: evolve(cmd_dir) â†’ evolution_result

ã‚¿ã‚¹ã‚¯å®Œäº†å¾Œã«é€²åŒ–ã‚¨ãƒ³ã‚¸ãƒ³ã‚’å®Ÿè¡Œã—ã€Personaã‚’æ›´æ–°ã™ã‚‹ã€‚

#### å…¥åŠ›

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | èª¬æ˜ |
|-----------|-----|------|
| `cmd_dir` | string | ã‚³ãƒãƒ³ãƒ‰ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆ`work/cmd_NNN`ï¼‰ |

#### å‡ºåŠ›

é€²åŒ–çµæœï¼ˆstdout ã«å‡ºåŠ›ï¼‰:

```
[evolve] Starting evolution for cmd_001
[evolve] Updated persona: generalist_v1 (tasks: 10, success_rate: 0.90)
[evolve] Few-shot registered: backend/subtask_001 (GREEN)
[evolve] Evolution complete for cmd_001
```

#### é€²åŒ–ã‚¹ãƒ†ãƒƒãƒ—è©³ç´°

evolveå®Ÿè¡Œæ™‚ã«ä»¥ä¸‹ã®å‡¦ç†ãŒé †æ¬¡è¡Œã‚ã‚Œã‚‹:

| # | ã‚¹ãƒ†ãƒƒãƒ— | å¯¾è±¡ | èª¬æ˜ |
|---|---------|------|------|
| 1 | ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ›´æ–° | `persona.performance` | `total_tasks`, `success_rate`, `last_task_date` ã‚’æ›´æ–° |
| 2 | å¤±æ•—è£œæ­£ | `persona.knowledge.domains` | å¤±æ•—ãƒ‰ãƒ¡ã‚¤ãƒ³ã® `proficiency` ã‚’ -0.02 èª¿æ•´ |
| 3 | è¡Œå‹•ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´ | `persona.behavior` | GREEN/REDå“è³ªã«åŸºã¥ã `risk_tolerance` ã‚’å¾®èª¿æ•´ |
| 4 | é©å¿œåº¦ã‚¹ã‚³ã‚¢è¨ˆç®— | `persona.evolution.fitness_score` | `fitness = w1*å“è³ª + w2*å®Œäº†ç‡ + w3*åŠ¹ç‡ + w4*æˆé•·ç‡`ï¼ˆç›´è¿‘20ã‚¿ã‚¹ã‚¯ã®ã‚¹ãƒ©ã‚¤ãƒ‡ã‚£ãƒ³ã‚°ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ï¼‰ |
| 5 | è‡ªå‹•ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ | `personas/history/` | `total_tasks` ãŒ5ã®å€æ•°ã«é”ã—ãŸã‚‰ä¿å­˜ |
| 6 | Few-Shotè‡ªå‹•ç™»éŒ² | `knowledge/few_shot_bank/{domain}/` | GREEN+success ã®çµæœã‚’ç™»éŒ²ï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³ã‚ãŸã‚Šæœ€å¤§ä»¶æ•°ã¯ `config.yaml` ã§è¨­å®šï¼‰ |

#### è²¬å‹™

- Workerçµæœã®YAML frontmatterã‚’è§£æ
- å¯¾å¿œã™ã‚‹Persona YAMLã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹çµ±è¨ˆã‚’æ›´æ–°
- é©å¿œåº¦ã‚¹ã‚³ã‚¢ã‚’å†è¨ˆç®—
- GREENå“è³ªã‚¿ã‚¹ã‚¯ã‚’Few-Shot Bankã«è‡ªå‹•ç™»éŒ²

#### claude-native å®Ÿè£…

```bash
bash scripts/evolve.sh work/cmd_NNN
```

å†…éƒ¨ã§ `scripts/_evolve_helper.py` ã‚’å‘¼ã³å‡ºã—ã€YAML frontmatterã®è§£æã¨Personaæ›´æ–°ã‚’å®Ÿè¡Œã€‚
é©å¿œåº¦ã‚¹ã‚³ã‚¢è¨ˆç®—ã¯ `scripts/_fitness.py` ã® `update_fitness_score()` ã‚’ä½¿ç”¨ã€‚

---

### IF-005: get_status() â†’ adapter_info

ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã®çŠ¶æ…‹ãƒ»è¨­å®šæƒ…å ±ã‚’è¿”ã™ã€‚

#### å…¥åŠ›

ãªã—ã€‚

#### å‡ºåŠ›

```yaml
adapter_info:
  name: "claude-native"
  version: "1.0"
  capabilities:
    parallel_execution: true
    max_parallel_workers: 5
    supported_models:
      - "claude-sonnet-4-6"
      - "claude-opus-4-6"
      - "claude-haiku-4-5-20251001"
    evolution_enabled: true
    few_shot_enabled: true
    trust_module_enabled: false
  directories:
    work_dir: "work"
    persona_dir: "personas/active"
    knowledge_dir: "knowledge"
    few_shot_dir: "knowledge/few_shot_bank"
  status: "ready"   # ready | busy | error
```

#### è²¬å‹™

- ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã®åå‰ãƒ»ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å ±å‘Š
- åˆ©ç”¨å¯èƒ½ãªæ©Ÿèƒ½ï¼ˆcapabilitiesï¼‰ã‚’ä¸€è¦§åŒ–
- ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã‚’å ±å‘Š
- ç¾åœ¨ã®ç¨¼åƒçŠ¶æ…‹ã‚’è¿”ã™

#### claude-native å®Ÿè£…

`config.yaml` ã‚’èª­ã¿å–ã‚Šã€`adapter_config.claude-native` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®æƒ…å ±ã‚’æ•´å½¢ã—ã¦è¿”ã™ã€‚

---

## 3. è¨­å®šã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

### ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼é¸æŠ

`config.yaml` ã® `adapter_set` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã‚’é¸æŠã™ã‚‹:

```yaml
tanebi:
  version: "1.0"
  adapter_set: "claude-native"   # â† ã“ã“ã§ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼åˆ‡æ›¿
```

### ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼å›ºæœ‰è¨­å®š

å„ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã¯ `adapter_config` å†…ã«å°‚ç”¨ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’æŒã¤:

```yaml
tanebi:
  adapter_config:
    claude-native:
      work_dir: "work"
      persona_dir: "personas/active"
      library_dir: "personas/library"
      history_dir: "personas/history"
      knowledge_dir: "knowledge"
      few_shot_dir: "knowledge/few_shot_bank"
      episode_dir: "knowledge/episodes"
      max_parallel_workers: 5
      worker_max_turns: 30
      default_model: "claude-sonnet-4-6"
      decomposer_model: "claude-sonnet-4-6"
      aggregator_model: "claude-sonnet-4-6"
```

### ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã®é…ç½®

å„ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã¯ `adapters/{adapter_name}/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®ã™ã‚‹:

```
adapters/
â”œâ”€â”€ claude-native/      # MVPå®Ÿè£…
â”‚   â”œâ”€â”€ adapter.yaml    # ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
â”‚   â”œâ”€â”€ scripts/        # ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼å›ºæœ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â””â”€â”€ templates/      # ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼å›ºæœ‰ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â”œâ”€â”€ subprocess/         # å°†æ¥å®Ÿè£…
â”‚   â””â”€â”€ ...
â””â”€â”€ http/               # å°†æ¥å®Ÿè£…
    â””â”€â”€ ...
```

### åŸºç›¤ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ï¼ˆ5ç¨®ï¼‰

å„å®Ÿè¡Œç’°å¢ƒã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã¯ã€å†…éƒ¨ã§ä»¥ä¸‹ã®5ç¨®ã®åŸºç›¤ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã‚’å®Ÿè£…ã™ã‚‹:

| åŸºç›¤ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ | è²¬å‹™ | claude-nativeå®Ÿè£… |
|--------------|------|------------------|
| Communication | ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–“ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚° | Task toolï¼ˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ³¨å…¥ + æˆ»ã‚Šå€¤ï¼‰ |
| Process | ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆèµ·å‹•ãƒ»ç›£è¦–ãƒ»åœæ­¢ | Task toolã®ä¸¦åˆ—å‘¼ã³å‡ºã— |
| State Store | ã‚¿ã‚¹ã‚¯ãƒ»çŠ¶æ…‹ã®æ°¸ç¶šåŒ– | ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ï¼ˆ`work/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼‰ |
| Knowledge Store | äººæ ¼ãƒ»çŸ¥è­˜ã®æ°¸ç¶šåŒ–ã¨æ¤œç´¢ | ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ï¼ˆ`personas/` + `knowledge/`ï¼‰ |
| Security | å¤–éƒ¨æ“ä½œã®æ¤œé–²ãƒ»æ‰¿èª | Claude Code permissionsè¨­å®š |

---

## 4. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°è¦ç´„

### åŸºæœ¬è¦ç´„

| é …ç›® | è¦ç´„ |
|------|------|
| æ­£å¸¸çµ‚äº† | exit code = 0 |
| ã‚¨ãƒ©ãƒ¼çµ‚äº† | exit code != 0 |
| ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ | stderr ã«å‡ºåŠ› |
| æ­£å¸¸å‡ºåŠ› | stdout ã«å‡ºåŠ› |

### result YAML ã§ã®ã‚¨ãƒ©ãƒ¼è¡¨ç¾

Workerå®Ÿè¡Œï¼ˆIF-002ï¼‰ãŒå¤±æ•—ã—ãŸå ´åˆã€result YAMLã® `status` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§å ±å‘Šã™ã‚‹:

```yaml
---
subtask_id: subtask_001
persona: generalist_v1
status: failure
quality: RED
domain: backend
error_detail: "ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒè¦‹ã¤ã‹ã‚‰ãªã‹ã£ãŸ"
---
```

### ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã”ã¨ã®ã‚¨ãƒ©ãƒ¼å‡¦ç†

| IF | å¤±æ•—æ™‚ã®æŒ™å‹• | ãƒªã‚«ãƒãƒªãƒ¼ |
|----|------------|-----------|
| IF-001 (decompose) | plan.md ãŒç”Ÿæˆã•ã‚Œãªã„ / exit != 0 | ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ãŒã‚¨ãƒ©ãƒ¼ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å ±å‘Š |
| IF-002 (execute) | result YAML ã® `status: failure` | AggregatorãŒå¤±æ•—ã‚’é›†è¨ˆã€‚é€²åŒ–ã‚¨ãƒ³ã‚¸ãƒ³ãŒå¤±æ•—è£œæ­£ã‚’é©ç”¨ |
| IF-003 (aggregate) | report.md ãŒç”Ÿæˆã•ã‚Œãªã„ / exit != 0 | ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ãŒã‚¨ãƒ©ãƒ¼ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å ±å‘Š |
| IF-004 (evolve) | stderr ã«ã‚¨ãƒ©ãƒ¼å‡ºåŠ› / exit != 0 | ã‚¿ã‚¹ã‚¯çµæœã¯ä¿å­˜æ¸ˆã¿ã€‚é€²åŒ–ã®ã¿ã‚¹ã‚­ãƒƒãƒ—ï¼ˆéè‡´å‘½çš„ï¼‰ |
| IF-005 (get_status) | stderr ã«ã‚¨ãƒ©ãƒ¼å‡ºåŠ› / exit != 0 | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ |

### ã‚¨ãƒ©ãƒ¼ã®ä¼æ’­

```
Workerå¤±æ•— â†’ result YAML (status: failure)
    â†’ Aggregator ãŒé›†è¨ˆ â†’ report.md ã«è¨˜è¼‰
    â†’ evolve.sh ãŒå¤±æ•—è£œæ­£ â†’ Persona ã® proficiency ã‚’ -0.02 èª¿æ•´
```

å¤±æ•—ã¯ **ç ´æ£„ã•ã‚Œãªã„**ã€‚ã™ã¹ã¦è¨˜éŒ²ã•ã‚Œã€é€²åŒ–ã‚¨ãƒ³ã‚¸ãƒ³ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ«ãƒ¼ãƒ—ã«çµ„ã¿è¾¼ã¾ã‚Œã‚‹ã€‚

---

## 5. å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

æ–°ã—ã„ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã‚’å®Ÿè£…ã™ã‚‹éš›ã®ç¢ºèªäº‹é …:

### å¿…é ˆé …ç›®

- [ ] IF-001ã€œIF-005 ã®5ã¤ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ã™ã¹ã¦å®Ÿè£…ã—ã¦ã„ã‚‹ã‹
- [ ] å…¥å‡ºåŠ›ãŒæœ¬ä»•æ§˜ã®YAMLãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«æº–æ‹ ã—ã¦ã„ã‚‹ã‹
- [ ] ã‚¨ãƒ©ãƒ¼æ™‚ã« exit code != 0 ã‚’è¿”ã—ã€stderr ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡ºåŠ›ã—ã¦ã„ã‚‹ã‹
- [ ] `config.yaml` ã® `adapter_set` ã§é¸æŠå¯èƒ½ã‹
- [ ] `adapter_config` ã«å°‚ç”¨ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ã‹

### Persona äº’æ›æ€§

- [ ] `personas/active/*.yaml` ã®Persona YAMLã‚¹ã‚­ãƒ¼ãƒã‚’å¤‰æ›´ãªãåˆ©ç”¨ã§ãã‚‹ã‹
- [ ] é€²åŒ–ã‚¨ãƒ³ã‚¸ãƒ³ï¼ˆIF-004ï¼‰ãŒPersona YAMLã‚’æ­£ã—ãæ›´æ–°ã™ã‚‹ã‹
- [ ] Few-Shot Bankï¼ˆ`knowledge/few_shot_bank/`ï¼‰ã¸ã®ç™»éŒ²ãŒæ©Ÿèƒ½ã™ã‚‹ã‹

### ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³äº’æ›æ€§

- [ ] Decompose â†’ Execute â†’ Aggregate â†’ Evolve ã®ãƒ•ãƒ­ãƒ¼é †åºã‚’éµå®ˆã—ã¦ã„ã‚‹ã‹
- [ ] waveå†…ã®ä¸¦åˆ—å®Ÿè¡Œã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ã‹
- [ ] ãƒ‘ã‚¹å—ã‘æ¸¡ã—ä¿‚åŸå‰‡ï¼ˆã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ã¯Workerå‡ºåŠ›ã‚’ç›´æ¥èª­ã¾ãªã„ï¼‰ã‚’éµå®ˆã—ã¦ã„ã‚‹ã‹

### ãƒ†ã‚¹ãƒˆ

- [ ] æ­£å¸¸ç³»: å˜ä¸€ã‚µãƒ–ã‚¿ã‚¹ã‚¯ã® Decompose â†’ Execute â†’ Aggregate â†’ Evolve
- [ ] æ­£å¸¸ç³»: è¤‡æ•°waveï¼ˆä¾å­˜é–¢ä¿‚ã‚ã‚Šï¼‰ã®ä¸¦åˆ—å®Ÿè¡Œ
- [ ] ç•°å¸¸ç³»: Workerå¤±æ•—æ™‚ã«AggregatorãŒæ­£ã—ãé›†è¨ˆã™ã‚‹ã‹
- [ ] ç•°å¸¸ç³»: å­˜åœ¨ã—ãªã„Personaã‚’æŒ‡å®šã—ãŸå ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œ
- [ ] é€²åŒ–: ã‚¿ã‚¹ã‚¯å®Œäº†å¾Œã«Persona YAMLãŒæ­£ã—ãæ›´æ–°ã•ã‚Œã‚‹ã‹
